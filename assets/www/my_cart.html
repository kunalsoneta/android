<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui"/>
<title>My Cart</title>

<link href="css/style.css" rel="stylesheet" type="text/css">
<link href="css/responsive.css" rel="stylesheet" type="text/css" />
<link href="css/framework1.css" rel="stylesheet" type="text/css">
<link href="css/style1.css" rel="stylesheet" type="text/css">
<link href="css/font-awesome.css" rel="stylesheet" type="text/css">
<link href="css/animate.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jqueryui.js"></script>
<script type="text/javascript" src="js/framework-plugins.js"></script>
<script type="text/javascript" src="js/custom.js"></script>

<link href="css/bootstrap.css" rel="stylesheet">

</head>

<body class="left-sidebar bg2">

<div id="preloader">
  <div id="status">
    <div class="preloader-logo"></div>
    <h3 class="center-text">Welcome</h3>
    <p class="center-text smaller-text"> We're loading the content, give us a second. This won't take long! </p>
  </div>
</div>

<div id="header" class="header">
	<div class="ri_1">
    <div class="header-elements_1">
    	<a href="#" class="left_back"><img src="images/back_icon.png" alt="" /></a>
        <div class="ho_ti">
            <h1>My Cart</h1>
		</div>
    	<a href="#" class="header-icon-3 open-left-sidebar"><img src="images/menu_icon.png" alt="" /></a>
    </div>
    </div>
         
</div>


<div class="all-elements">
    <div class="snap-drawers">
        <!--Left Sidebar-->
        <div class="snap-drawer snap-drawer-left">
            <div class="sidebar-header-left">
                <a class="sidebar_prof" href="#">
                	<div class="left_logo_p cf">
                        <div class="te_left">
                        	<img src="images/logo.png" alt="logo" />
                        </div>
                    </div>
                </a>
            </div>      
            <div class="sidebar-menu">
			    <a class="menu-item" href="#">
                    <div class="link_box cf">
                        <div class="link_title">
                        	<img src="images/menu_icon_d.png" alt="" />
                        	<h1>Dashboard</h1>
                        </div>
                    </div>
                </a>
				
                <a class="menu-item" href="#">
                    <div class="link_box cf">
                        <div class="link_title">
                        	<img src="images/menu_icon_m.png" alt="" />
                        	<h1> My Account Information</h1>
                        </div>
                    </div>
                </a>                
                <a class="menu-item" href="#">
                    <div class="link_box cf">
                        <div class="link_title">
                        	<img src="images/menu_icon_o.png" alt="" />
                        	<h1> Order Histroy</h1>
                        </div>
                    </div>
                </a>      
                <a class="menu-item" href="#">
                    <div class="link_box cf">
                        <div class="link_title">
                        	<img src="images/menu_icon_r.png" alt="" />
                        	<h1>Recent Order Information</h1>
                        </div>
                    </div>
                </a>                
                <a href="customer_care.html" class="menu-item">
                    <div class="link_box cf">
                        <div class="link_title">
                        	<img src="images/menu_icon_l.png" alt="" />
                        	<h1>Logout</h1></div>
                        </div>
                </a>                 
            </div>

        </div>
        
        
        
        <div id="content" class="snap-content bg2">
            <!--<div class="logo">
            	<a href="#"><img src="images/logo.png" alt="logo" /></a>
            </div>-->
            <div class="my_f">
            <div class="my_box">
            	<table width="200%" border="1">
                  <tr class="pd">
                    <td width="60%" height="30px"><h3>Product Name</h3></td>
                    <td width="20%"><h3>Qty</h3></td>
                    <td width="20%"><h3>Price</h3></td>
                    <td width="10%"><h3>&nbsp;</h3></td>
                  </tr>
                  <tr>
                    <td height="30px"><span>1</span><h4>Fresh Fruit Skewers</h4></td>
                    <td>2</td>
                    <td>$ 58.98</td>
                    <td><img src="images/cl_icon.png" alt="" /></td>
                  </tr>
                  <tr>
                    <td height="30px"><span>2</span><h4>Fresh Fruit Skewers</h4></td>
                    <td>2</td>
                    <td>$ 58.98</td>
                    <td><img src="images/cl_icon.png" alt="" /></td>
                  </tr>
                  <tr>
                    <td height="30px"><span>3</span><h4>Fresh Fruit Skewers</h4></td>
                    <td>2</td>
                    <td>$ 58.98</td>
                    <td><img src="images/cl_icon.png" alt="" /></td>
                  </tr>
                  <tr>
                    <td height="30px"><span>4</span><h4>Fresh Fruit Skewers</h4></td>
                    <td>2</td>
                    <td>$ 58.98</td>
                    <td><img src="images/cl_icon.png" alt="" /></td>
                  </tr>
                  <tr>
                    <td height="30px"><span>5</span><h4>Fresh Fruit Skewers</h4></td>
                    <td>2</td>
                    <td>$ 58.98</td>
                    <td><img src="images/cl_icon.png" alt="" /></td>
                  </tr>
                </table>
            </div>
            </div>
            
            <div class="cof_btn">
                	<button>Confirm Order</button>
                </div>
            
        </div>
    </div>  
</div>



<div class="main_ap">
	
</div>

<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $('#tabs').tab();
    });
</script>

<script type="text/javascript" src="js/bootstrap.js"></script>

<script src="js/jquery-1.9.1.min.js"></script> 
<script type="text/javascript" src="js/framework-plugins.js"></script>
<script src="js/owl.carousel.js"></script>

<script>
    $(document).ready(function() {
      $("#owl-demo").owlCarousel({

      navigation : true,
      slideSpeed : 300,
      paginationSpeed : 400,
      singleItem : true,
	  autoPlay : 3000,
      // "singleItem:true" is a shortcut for:
      // items : 1, 
      // itemsDesktop : false,
      // itemsDesktopSmall : false,
      // itemsTablet: false,
      // itemsMobile : false

      });
    });
    </script>
<script>
$(window).load(function() {
	$("#status").fadeOut(); // will first fade out the loading animation
	$("#preloader").delay(100).fadeOut("slow"); // will fade out the white DIV that covers the website.
});

var response;
var productid = [];
var jsonObj = [];
var totalgrandamount = 0;
var totalamt = 0;
var quo = "";
var finalamount = 0;
var totalitemfnp = 0;
 var unitis = "";
var totalrupess = "";
var min_quantity = 0;
localStorage.setItem('orderpro',"")
localStorage.setItem('totalpaidfnpamt',"0");
localStorage.setItem('totalitemfnp',"0")
// var urlis = "http://localhost/fnpwebservice/fnpweb/webservice.php?";
// var urlis = "http://63.142.255.51/fnpweb/webservice.php?";

var urlis = "http://testweb4you.com/projects/earthmart/emtweb/webservice.php?";

getallprois();
    // Display Cart Data

		 function printcart(proid)
		 {

			 totalgrandamount = 0;
			 var htmladd = ""
			 var qtyfinal = 0;
			 var last = 0;
			$.each(response, function(i, v) {
				item = {}
			for (var i=0;i<proid.length;i++)
			{
				if (v.product_id == proid[i])
				{

						    unitis = "";
						    totalrupess = "";
						    min_quantity = 0;
							if (v.min_quantity < 1)
							{

								totalrupess = v.min_quantity * v.product_price
								unitis = "Grms";
								min_quantity = v.min_quantity;

								if ( (v.min_quantity == 0) && (v.unit_name == "KG"))
								{
								totalrupess =  v.product_price
								unitis = "KG";
								min_quantity = "1.00";
								}
								if ( (v.min_quantity == 0) && (v.unit_name == "PCS"))
								{
								totalrupess =  v.product_price
								unitis =  "PCS";
								min_quantity = "1";
								}
							}
							else
							{
							totalrupess = v.min_quantity * v.product_price
							unitis =  "KG";
							min_quantity = v.min_quantity;
							}
						if (v.product_id  == last)
						{
							 qtyfinal =  qtyfinal+1;
							 $('#q'+ last+'').html(qtyfinal);
							 var proprice =  parseFloat(totalrupess).toFixed(2);
							 finalamount =  parseFloat(parseFloat(finalamount) +  parseFloat(proprice)).toFixed(2);
							 $('#amt'+ last+'').html(parseFloat(finalamount).toFixed(2));
							  totalgrandamount =  (parseFloat(totalgrandamount) +   parseFloat(proprice));
							jsonObj.splice(jsonObj.indexOf("pid"), 1);
							item ["pid"] = quo + v.product_id + quo;
							item ["pqty"] = quo + qtyfinal + quo;
							item ["pamt"] = quo + parseFloat(finalamount).toFixed(2) + quo;
	       					jsonObj.push(item);
						}else
						{

							finalamount = parseFloat(totalrupess).toFixed(2);
							totalgrandamount =  (parseFloat(totalgrandamount) +  parseFloat(finalamount));
							qtyfinal = 0;
							qtyfinal =  qtyfinal+1;
							totalitemfnp = totalitemfnp+1;


				        	item ["pid"] = quo + v.product_id + quo;
							item ["pqty"] = quo + qtyfinal + quo;
							item ["pamt"] = quo + parseFloat(finalamount).toFixed(2) + quo;
	       					jsonObj.push(item);

							 if(unitis == "Grms") { min_quantity = parseFloat(min_quantity).toFixed(3); } else {
								 min_quantity =  parseFloat(min_quantity).toFixed(0);
								 }
								 totalrupess =   parseFloat(totalrupess).toFixed(2);
								 finalamount =    parseFloat(finalamount).toFixed(2);

			//	htmladd = '<div id="pro'+ v.product_id +'" class="box"> <a href="#"  title="our caption here!"><img src="http://freshnpack.com/assets/upload/product/'+ v.product_image +'" alt="'+ v.product_name +'" width="124" height="115"></a><div class="in_te_box"><h2>'+  v.product_name +'</h2><h3>'+ min_quantity + '&nbsp;' + unitis + '</h3><h4><i class="fa fa-inr"></i> '+ totalrupess +' &times; <span id="q'+ v.product_id +'">1</span></h4></div><div class="right_cas_r"><p id="p'+ v.product_id +'"><i class="fa fa-inr"></i><span id=amt'+ v.product_id +'>'+finalamount+'</span></p><span><img src="images/cancel_icon.png" onClick="javascript:removecart('+ v.product_id +')" alt="cancel icon"></span></div></div>';
			//	htmladd = '<div id="pro'+ v.product_id +'"  class="box_01 cf"><div  class="pr_img"><img src="http://testweb4you.com/projects/earthmart/assets/upload/product/'+ v.product_image +'" alt="'+ v.product_name +'" /></div><div class="pr_dt"><h4>'+  v.product_name +'</h4><p>'+ min_quantity + '&nbsp;' + unitis + '</p><h3><span>rs  '+ totalrupess +'  x</span><span id="q'+ v.product_id +'">1</span></h3></div><div class="right_cas_r"><p id="p'+ v.product_id +'"><span id=amt'+ v.product_id +'>'+finalamount+'</span></p><span><img src="images/cancel_icon.png" onClick="javascript:removecart('+ v.product_id +')" alt="cancel icon"></span></div></div><br/>';
                htmladd = '';


                $('#totalorder').append(htmladd);
						}
						last = v.product_id;
			   }
			}
			});
			localStorage.setItem('totalpaidfnpamt',totalgrandamount);
			$('#totalamt').html(parseFloat(totalgrandamount).toFixed(2));
			$('#paybal').html(parseFloat(totalgrandamount).toFixed(2)) ;
			localStorage.setItem('orderpro',JSON.stringify(jsonObj))
		 }
		 function removecart(idis)
		 {

			 	var stringis = String( localStorage.getItem('addtocartlistlocal'));
				finalDatais = JSON.parse(stringis);
				if(JSON.stringify(finalDatais) != '""')
					{
					   $.each(finalDatais, function(i,v) {

						  if(v.productid == idis) {
							  finalDatais.splice(i, 1);
							  removedatais(idis);
							  localStorage.setItem('addtocartlistlocal',JSON.stringify(finalDatais))
							  return false;
						  }
					   });

				}

		}

		function removedatais(idis){


           var qtyid  =	 $('#q'+ idis+'').html()
		   var amtis  =	 $('#amt'+ idis+'').html()
		   var grdtotalamtis  =	 $('#totalamt').html();
		   var paybalis = $('#paybal').html();
		   var peritemamt = parseFloat(amtis/qtyid);
		   $('#q'+ idis+'').html(parseInt(qtyid) - 1);
		    $('#amt'+ idis+'').html((parseFloat(amtis) - peritemamt).toFixed(2));
			$('#totalamt').html( (parseFloat(grdtotalamtis) - peritemamt).toFixed(2));
			$('#paybal').html( (parseFloat(paybalis) - peritemamt).toFixed(2));

			if (( parseInt(qtyid) - 1) == 0 )
			{
				 $('#pro'+ idis+'').remove();
			}
			 grdtotalamtis  =	 $('#totalamt').html();
			 localStorage.setItem('totalpaidfnpamt',grdtotalamtis);


			 var productlist = String(localStorage.getItem('orderpro'));
				var productliststring = JSON.parse(productlist);
				if(JSON.stringify(productliststring) != '""')
					{
					   $.each(productliststring, function(i,v) {
						  if(v.pid == idis) {
							  v.pqty = parseInt(qtyid) - 1;
							  v.pamt = (parseFloat(amtis) - peritemamt).toFixed(2);
							  if(v.pqty == 0)
							  {
							  	productliststring.splice(i, 1);
							  }
							  localStorage.setItem('orderpro',JSON.stringify(productliststring));
							  return false;
						  }
					   });
					}
					//alert(localStorage.getItem('orderpro'));

		}
		 function getallprois(){

		 	$.ajax({
				type       : "POST",
				url        : urlis+"action=GetProduct&category_name=0&format=json",
				crossDomain: true,
			    //beforeSend : function() {$.mobile.loading('show')},
			   // complete   : function() {$.mobile.loading('hide')},
				data: '{}',
				dataType   : 'json',
				success    : function(responseis) {
					checkcart(responseis);

				}
			});
		 }


		 function checkcart(responseis)
		 {

            response = responseis;
			var string = String( localStorage.getItem('addtocartlistlocal'));
				if (string.length > 0)
				{
				var finalData = string.replace("\\", "");
				finalData = JSON.parse(finalData);
				if(JSON.stringify(finalData) != '""')
					{

						$.each(finalData, function(i, v) {
						productid.push(v.productid);
						});
					}

					// alert(response);
					 printcart(productid.sort())

				}


		 }

		  function checkback()
			{
			localStorage.setItem('catidis','1');
			window.location = "productv.html";
			}


		   $("#notifi").hide();
		   $('#checkoutad').click(function(){
				 	 if(localStorage.getItem('totalpaidfnpamt') > 0 )
						{
							localStorage.setItem('totalitemfnp',totalitemfnp)
                            window.location = "checkout_pd.html";
							}
							else
							{
								 $("#notifi").show().delay(5000).fadeOut();
									$(".fancybox").fancybox({
									'href' : '#popupID'
									});
							}

		  });
</script>


</body>
</html>
